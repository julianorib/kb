# Guia Master AZ-104 – Azure Administrator Associate

## O exame AZ-104 cobra principalmente:

- Gestão de identidades e acesso (20–25%)
- Implementação e gerenciamento de storage (15–20%)
- Implantação e gerenciamento de recursos de computação (20–25%)
- Configuração de redes virtuais (20–25%)
- Monitoramento e backup (10–15%)

## Ref:
<https://learn.microsoft.com/pt-br/credentials/certifications/azure-administrator/?practice-assessment-type=certification>

<https://learn.microsoft.com/pt-br/training/courses/az-104t00>

<https://learn.microsoft.com/pt-br/credentials/certifications/azure-administrator/practice/assessment?assessment-type=practice&assessmentId=21&practice-assessment-type=certification>

## 1. Identidade e Governança
### Azure AD (Entra ID)

O Microsoft Entra ID é o serviço de identidade e acesso na nuvem da Microsoft.
Ele faz o papel de um “Active Directory na nuvem”, mas não substitui completamente o AD local: ele é uma solução diferente e complementar.

É responsável por:

- Autenticar usuários e dispositivos.
- Controlar permissões de acesso a recursos e aplicativos (Azure, M365, SaaS, etc).
- Aplicar políticas de segurança como MFA, Acesso Condicional, Identity Protection.
= Oferecer SSO (Single Sign-On) entre milhares de aplicações.

Pense nele como o cérebro de identidade do Microsoft Cloud: tudo o que envolve login, autenticação e controle de acesso passa por ele.

- Um usuário convidado tem as mesmas propriedades de um usuário comum.
- É possivel usar comandos para convidar multiplos usuários por um arquivo .csv.
    - New-AzureADMSInvitation - AzureAD - Legado
    - New-MgInvitation - Microsoft.Graph - Atual 

### Principais Características do Entra ID

- **Identidade como serviço (IDaaS)**
Não precisa de servidores locais — é totalmente gerenciado pelo Azure.

- **Autenticação e Autorização centralizadas**
Todos os logins corporativos passam por ele (M365, Azure, SaaS, apps customizados).

- **Single Sign-On (SSO)**
Login único para diversos aplicativos, reduzindo senhas e melhorando a experiência.

- **Multi-Factor Authentication (MFA)**
Adiciona camadas de segurança (SMS, App Authenticator, biometria, etc).

- **Conditional Access**
Define condições de login (localização, dispositivo, risco do usuário, etc).

- Uma Politica de exigir MFA, deve partir de um Conditional Access.
- Cria-se uma politica e define que o grupo X deve exigir MFA.

- **Identity Protection**
Detecta logins suspeitos e bloqueia automaticamente possíveis ataques.

- **Integração com diretórios locais (AD Connect)**
Permite sincronizar usuários, grupos e senhas do AD local com a nuvem.

- **Managed Identities**
Identidades automáticas para recursos do Azure (sem precisar guardar senhas).

- É um recurso para dar permissões de leitura de keys, chaves, certificados, etc sem precisar informar senhas.
- Cria-se uma Identidade Gerenciada.
- Associa-se essa identidade em um IAM do Recurso (exemplo: keyvault - Reader)
- No outro recurso que deverá ter acesso ao Keyvault, informa o tipo de Identidade (user-assigned), e seleciona a Managed Identity.


- **RBAC e PIM (Privileged Identity Management)**
Controle granular de permissões e ativação de privilégios temporários.

- **APIs e suporte a protocolos abertos**
Compatível com OAuth 2.0, OpenID Connect, SAML e WS-Fed, facilitando integrações externas.

- **Alta Disponibilidade**: SLA de 99,9% com failover entre datacenters Microsoft

- **Escalabilidade**: Serviço global, com replicação automática e integração com multiplas regiões.

- **Sync AD Local**:
```
Start-ADSyncSyncCycle -PolicyType Initial
Start-ADSyncSyncCycle -PolicyType Delta
```

### Recursos Principais e Avançados:

- **1. Conditional Access**

- Define regras de login, como:
- Bloquear logins de fora do país.
- Exigir MFA em redes públicas.
- Permitir login automático em redes corporativas.

É o “firewall de autenticação” da organização.

- **2. Self-Service Password Reset (SSPR)**

Permite que o próprio usuário redefina sua senha de forma segura.
Ajuda a reduzir chamados no helpdesk e melhora a segurança com MFA na recuperação.

- **3. Privileged Identity Management (PIM)**

Gerencia identidades administrativas com acesso just-in-time (JIT).
Evita que usuários fiquem com privilégios permanentes.

- **4. Azure AD Connect (Entra Connect)**

Ferramenta para sincronizar o AD local com Entra ID.
Permite sincronização de hash de senha, federation (ADFS) e Write-back (senha e grupos).

 Fundamental em ambientes híbridos.

- **5. Entra ID Join / Hybrid Join**

    - **Azure AD Join**: Dispositivos corporativos registrados diretamente na nuvem.

    - **Hybrid Join**: Dispositivos ingressados no domínio local e sincronizados com o Entra ID.

Integra com Intune para políticas de conformidade e MDM.

- **6. Application Proxy**

Permite publicar aplicações internas (on-premises) com segurança, sem precisar abrir portas públicas.
Funciona como um “reverse proxy” seguro autenticado pelo Entra ID.

- **7. Reports & Monitoring**

    - Logs de login, falhas, riscos e alertas.
    - Integração com Azure Monitor, Sentinel e Defender for Cloud Apps.
    - Fornece insights de segurança e conformidade.

### Licenças (Planos):

- **Entra ID Free**
    - Incluído em todas as assinaturas Azure e M365.
    - Recursos: gerenciamento de usuários, grupos, SSO para até 10 apps, logon básico e autenticação moderna.

- **Entra ID P1 (Premium 1)**
    - Ideal para empresas médias/grandes.
    - Recursos adicionais: Conditional Access, Dynamic Groups, Self-Service Password Reset (SSPR) e Cloud App Discovery.
    - Incluído em Microsoft 365 E3.

- **Entra ID P2 (Premium 2)**
    - Voltado à segurança corporativa avançada.
    - Recursos extras: Identity Protection, Access Reviews, Privileged Identity Management (PIM).
    - Incluído em Microsoft 365 E5.

- **Observações**:
    - Um usuário ou grupo que tenham licenças associadas, não pode ser excluido sem antes remover as licenças.

### Access Control (IAM) - RBAC (Role-Based Access Control)

- **Descrição**:
Sistema que permite definir quem pode fazer o quê dentro do Azure. Ele controla permissões em nível granular, desde o escopo da assinatura até o recurso individual, garantindo que cada usuário tenha apenas o acesso necessário.

- **Casos de uso**:
Garantir que apenas administradores possam gerenciar redes, enquanto desenvolvedores só têm acesso a VMs ou storage.

- **Caracteristicas principais**:
Controle por função (Owner, Contributor, Reader), herança hierárquica e suporte a roles customizadas.

- **Escalabilidade**:
Aplicável em qualquer escopo de hierarquia (Management Group → Subscription → Resource Group → Resource).

- **Disponibilidade**:
Serviço nativo, redundante e integrado ao Azure AD.

- **Segurança**:
Segue o princípio de privilégio mínimo e é totalmente auditável.

- Você pode adicionar permissões IAM a um recurso para:
    - Usuários
    - Grupos (segurança e 365)
    - Grupos aninhados (um grupo que pertence a outro grupo)
    - Conta gerenciada

### Azure Policy

- **Descrição**:
Serviço que garante que os recursos do Azure estejam em conformidade com regras e padrões definidos pela organização. Pode aplicar políticas preventivas (deny) ou corretivas (remediation).

Uma politica aplicada após já existirem recursos, não modifica nenhum recurso existente, apenas pode barrar a criação de novos.
O painel de conformidade do Azure Policy, pode ser utilizado para visualizar quais recursos não estão em conformidade.

- **Casos de uso**:
Impedir a criação de VMs fora de uma região específica, exigir tags obrigatórias ou aplicar criptografia automática em discos.

- **Caracteristicas principais**:
Políticas herdáveis, avaliação automática, relatórios de conformidade.

- **Escalabilidade**:
Pode ser aplicada globalmente através de Management Groups.

- **Disponibilidade**:
Distribuído e altamente disponível.

- **Segurança**:
Mantém a conformidade e reduz riscos de configuração insegura.

Você deve usar o campo RemediationDescription na seção de metadados das propriedades para especificar uma informação de correção na Politica.

- É possível definir uma Azure Policy para configurações padrões em determinados Recursos.
    - Exemplo: Adicionar um bloqueio/liberação para porta 8080 ao criar qualquer NSG.

### Management Groups

- **Descrição**:
Estrutura hierárquica para organizar várias assinaturas do Azure sob um único ponto de governança.

- **Casos de uso**:
Separar ambientes (produção, testes, dev) e aplicar políticas globais de compliance e RBAC.

- **Caracteristicas principais**:
Herança de políticas, organização hierárquica e gerenciamento centralizado.

- **Escalabilidade**:
Suporta centenas de assinaturas.

- **Disponibilidade**:
Serviço resiliente e global.

- **Segurança**:
Centraliza políticas e acessos, reduzindo erros humanos.

## 2. Rede
### Virtual Network (VNet)

- **Descrição**:
É a base da comunicação privada no Azure. Funciona como uma rede virtual isolada, onde você pode criar sub-redes, rotear tráfego, definir IPs privados e integrar com redes locais.

- **Casos de uso**:
Hospedagem de VMs, integração de aplicativos com bancos de dados e conexão com ambientes on-premises via VPN.

- **Caracteristicas principais**:
 Suporte a subnets, DNS customizado, peering, NSG e roteamento personalizado.

- **Escalabilidade**:
Pode crescer por sub-redes e peering entre VNets.

- **Disponibilidade**:
Alta redundância e conectividade global.

- **Segurança**:
Segmentação de rede e isolamento lógico.

- **Ips Reservados**:
    ```
    - x.x.x.1 -> Gateway Padráo
    - x.x.x.2 -> Dns 1
    - x.x.x.3 -> Dns 2
    ```

Uma boa prática, é criar uma Subnet para Private Endpoints.

### VNet Peering

- **Descrição**:
Conexão direta entre VNets, permitindo comunicação privada via backbone do Azure.

- **Casos de uso**:
Interligar ambientes (produção ↔ dev) sem VPN.

- **Características**:
Baixa latência, alta largura de banda.

- **Escalabilidade**:
Global (com Global Peering).

- **Disponibilidade**:
Alta.

- **Segurança**:
Não roteia automaticamente para VNets em cadeia (não transitivo).

- **Componentes obrigatórios**:
    - Duas VNets
    - Peering configurado nos dois lados

### Hub & Spoke Architecture

- **Descrição**:
Modelo de rede onde uma VNet central (hub) conecta VNets satélites (spokes).

- **Casos de uso**:
Centralizar serviços compartilhados (firewall, VPN, monitoramento).

- **Características**:
Escalável, modular e facilita o isolamento de workloads.

- **Escalabilidade**:
Alta (dezenas de spokes).

- **Disponibilidade**:
Regional.

- **Segurança**:
Controle centralizado via NSG, Firewall e rota.

- **Componentes obrigatórios**:
    - VNet Hub
    - VNets Spokes
    - Peerings entre elas

### Network Security Group (NSG)

- **Descrição**:
Controla o tráfego de entrada e saída de VMs e sub-redes por meio de regras baseadas em IP, porta e protocolo.

- **Casos de uso**:
Restringir acesso remoto (RDP/SSH), liberar apenas portas HTTP/HTTPS, ou bloquear IPs maliciosos.

- **Caracteristicas principais**:
Listas de regras de segurança, logs de fluxo e integração com Azure Monitor.

- **Escalabilidade**:
Pode ser aplicado a várias interfaces de rede.

- **Disponibilidade**:
Serviço PaaS totalmente gerenciado.

- **Segurança**:
Protege contra tráfego indesejado e permite auditoria detalhada.

- **Outras caracteristicas**:

    Pode ser atribuido a sub-rede ou a interface de rede.

    Por padrão, os NSG vem com as regras:

        Inbound:
        - Allow From VNET to VNET any Ports/Protocol
        - Allow From LB to All any Ports/Protocol
        - Deny All

        Outbound:
        - Allow From VNET to VNET any Ports/Protocol
        - Allow From Any to Internet any Ports/Protocol
        - Deny All

### VNet Gateway

- **Descrição**:
Gateway que permite comunicação entre redes locais e o Azure (VPN ou ExpressRoute).

- **Casos de uso**:
Conectar datacenter on-premises à nuvem.

- **Características**:
VPN (IKEv2/IPSec) ou ExpressRoute (circuito dedicado).

- **Escalabilidade**:
Limitado por SKU e banda.

- **Disponibilidade**:
Regional, redundante (ativo/passivo).

- **Segurança**:
Criptografia ponta a ponta.

- **Componentes obrigatórios**:
    - subnet exclusiva com o nome GatewaySubnet (/27 ou maior)
    - Public IP
    - Virtual Network Gateway

- **Policy VNET Gateway x Route based VNET Gateway**:
    - Policy é baseado em SKU Basic, não recomendado para ambiente produtivo
    - Policy funciona apenas para Site to Site
    - Route Based são mais flexiveis
    - Atualmente não tem mais esta opção de Policy.

### Azure NAT Gateway

- **Descrição**:
Serviço que fornece saída de internet segura e escalável para recursos dentro de uma VNet, sem IP público direto.

- **Casos de uso**:
Permitir que VMs privadas acessem a internet com IP fixo.

- **Características**:
NAT de saída somente, suporta até 64.000 conexões simultâneas por IP.

- **Escalabilidade**:
Automática (aumente IPs públicos para expandir).

- **Disponibilidade**:
Regional, com redundância embutida.

- **Segurança**:
Evita exposição pública, IP fixo para whitelisting.

- **Componentes obrigatórios**:
    - Public IP ou Public IP Prefix
    - NAT Gateway
    - Subnet associada

### VPN Site-to-Site

- **Descrição**:
Conexão entre uma rede local e uma VNet do Azure via internet usando IPsec/IKEv2.

- **Casos de uso**:
Expandir rede corporativa para o Azure.

- **Características**:
Requer gateway VPN no Azure e appliance VPN local.

- **Escalabilidade**:
Limitada a 30 túneis (dependendo da SKU).

- **Disponibilidade**:
Regional, redundante.

- **Segurança**:
Tráfego criptografado fim a fim.

- **Componentes obrigatórios**:
    - Virtual Network Gateway
    - Public IP
    - Local Network Gateway
    - Connection

### VPN Client-to-Site ou Point-to-Site

- **Descrição**:
Conexão de usuários individuais (notebooks, VPN client) diretamente à VNet via túnel seguro.

- **Casos de uso**:
Acesso remoto seguro à rede corporativa.

- **Características**:
Suporte a OpenVPN, SSTP, IKEv2.

- **Escalabilidade**:
Até milhares de conexões (SKU Premium).

- **Disponibilidade**:
Regional.

- **Segurança**:
Certificados, MFA e autenticação com Azure AD.

- **Componentes obrigatórios**:
    - Virtual Network Gateway (VPN SKU)
    - Point-to-Site configuration
    - Certificados ou Azure AD auth

### Private Link / Private Endpoint

- **Descrição**:
Cria conexão privada (com IP interno) entre sua VNet e um serviço PaaS do Azure (Storage, SQL, etc.).

- **Casos de uso**:
Conectar serviços críticos sem tráfego pela internet pública.

- **Características**:
Usa IPs privados da VNet, substitui Service Endpoint com segurança superior.

- **Escalabilidade**:
Suporte a múltiplos endpoints por serviço.

- **Disponibilidade**:
Regional.

- **Segurança**:
Tráfego totalmente privado, integrado ao NSG e firewall interno.

### Service Endpoint

- **Descrição**:
Extensão de rede que permite o acesso direto e seguro a serviços PaaS (Storage, SQL, etc.) via backbone do Azure.

- **Casos de uso**:
Restringir acesso ao serviço PaaS apenas à VNet corporativa.

- **Características**:
Mantém o IP público do serviço, mas trafega internamente.

- **Escalabilidade**:
Regional.

- **Disponibilidade**:
Regional, automática.

- **Segurança**:
Bloqueia acessos externos; comunicação interna criptografada.

### Rotas (UDR – User Defined Routes)

- **Descrição**:
Permitem controlar o roteamento entre subnets, VNets ou firewalls.

- **Casos de uso**:
Direcionar tráfego por appliances de segurança ou NVA.

- **Características**:
Suporte a next hop: Virtual Appliance, Internet, Virtual Network Gateway.

- **Escalabilidade**:
Por subnet.

- **Disponibilidade**:
Regional.

- **Segurança**:
Impede roteamento indesejado.


### Zona DNS Interna

- **Descrição**:
Serviço DNS privado para resolução de nomes dentro de VNets.

- **Casos de uso**:
Resolver nomes de VMs, serviços internos e Private Endpoints.

- **Características**:
Suporte a split-horizon DNS, registro automático.

- **Escalabilidade**:
Regional (mas pode ser linkada a várias VNets).

- **Disponibilidade**:
Alta, com redundância automática.

- **Segurança**:
Não é acessível externamente, controlado por RBAC.

### Zona DNS Externa (Public DNS Zone)

- **Descrição**:
Serviço DNS público para hospedar domínios e registros acessíveis pela internet.

- **Casos de uso**:
Hospedar o domínio público de um site, API ou aplicação.

- **Características**:
Suporte a registros A, CNAME, TXT, MX, etc.

- **Escalabilidade**:
Global.

- **Disponibilidade**:
Alta (redundância global DNS).

- **Segurança**:
RBAC e integração com Resource Locks.

### Azure Load Balancer

- **Descrição**:
Balanceador de carga de camada 4 (TCP/UDP). Distribui tráfego entre VMs ou instâncias de serviços dentro de uma VNet.
É necessário o uso de um IP Publico do tipo Standard.

- **Casos de uso**:
Balancear requisições entre VMs (front-end web, APIs, RDP, etc).

- **Características**:
Suporte a balanceamento interno ou externo, probes de integridade, NAT rules e HA Ports.

- **Escalabilidade**:
Altamente escalável (milhões de conexões).

- **Disponibilidade**:
Regional ou zonal. Pode ser Standard (redundante em zonas).

- **Segurança**:
Integra-se com NSGs e suporta tráfego somente autorizado.

- **Componentes obrigatórios**:
    - Frontend IP Configuration
    - Backend Pool
    - Health Probe

### Azure Application Gateway

- **Descrição**:
Balanceador de carga de camada 7 com recurso de Web Application Firewall (WAF). Atua no tráfego HTTP/HTTPS e protege aplicações contra ataques comuns.

- **Casos de uso**:
Hospedagem de sites corporativos com segurança OWASP.

- **Caracteristicas principais**:
SSL offload, roteamento baseado em URL, autoscaling e WAF integrado.

- **Escalabilidade**:
Escala automática de instâncias.

- **Disponibilidade**:
Multi-AZ.

- **Segurança**:
Mitiga vulnerabilidades como SQL Injection e XSS.

- **Componentes obrigatórios**:
    - Frontend IP
    - Listener
    - Backend Pool
    - HTTP Settings
    - Rules (roteamento)

### Azure Traffic Manager

- **Descrição**:
Balanceador de carga global baseado em DNS que direciona usuários para o endpoint mais apropriado.

- **Casos de uso**:
Redirecionar tráfego entre regiões, failover global, balanceamento por desempenho ou prioridade.

- **Características**:
Baseado em DNS, suporta vários métodos de roteamento (priority, performance, geographic).

- **Escalabilidade**:
Global (sem limite de endpoints).

- **Disponibilidade**:
Global (SLA 100% DNS).

- **Segurança**:
Integra-se com HTTPS endpoints e suporta apenas endereços públicos válidos.

- **Componentes obrigatórios**:
    - DNS Profile
    - Endpoints (Azure, externos ou nested profiles)

### Azure Firewall

- **Descrição**:
Firewall gerenciado que inspeciona tráfego de rede de camadas 3 a 7. Suporta regras de filtragem, NAT e inspeção de pacotes SSL.

- **Casos de uso**:
Proteger VNets corporativas, controlar acesso entre redes e aplicar políticas centralizadas de tráfego.

- **Caracteristicas principais**:
SNAT/DNAT, filtragem de domínio (FQDN), TLS inspection, Threat Intelligence.

- **Escalabilidade**:
Escala automaticamente conforme a demanda.

- **Disponibilidade**:
Alta, com redundância ativa.

- **Segurança**:
Proteção avançada contra ameaças e integração com Sentinel.

## 3. Armazenamento
### Storage Account

| Tipo                               | Descrição                                     | Quando usar                                       | Suporta Blobs | Suporta Files       | Suporta Queues | Suporta Tables | Performance        | Observações                                                                   |
| ---------------------------------- | --------------------------------------------- | ------------------------------------------------- | ------------- | ------------------- | -------------- | -------------- | ------------------ | ----------------------------------------------------------------------------- |
| **StorageV1 (legacy)**             | Primeira geração; recursos limitados          | Ambientes antigos; nunca usar em projetos novos   | ✔             | ✔                   | ✔              | ✔              | Standard           | Não suporta hot/cool; sem vários recursos modernos                            |
| **StorageV2 (General Purpose v2)** | Versão atual e recomendada para 99% dos casos | Qualquer workload moderno                         | ✔             | ✔                   | ✔              | ✔              | Standard / Premium | Suporta tiering Hot/Cool/Archive, soft delete, versionamento; custo otimizado |
| **BlobStorage (legacy)**           | Armazena apenas blobs com controle de tiering | Apenas workloads **somente blob** legados         | ✔ (somente)   | ✘                   | ✘              | ✘              | Standard           | Já substituído pelo StorageV2                                                 |
| **BlockBlobStorage**               | Conta otimizada para blobs **Premium (SSD)**  | Alta velocidade, ingestão massiva, baixa latência | ✔             | ✘                   | ✘              | ✘              | Premium (SSD)      | Ideal para big data, ingestão, analytics                                      |
| **FileStorage**                    | Conta premium exclusiva para **Azure Files**  | Azure Files em alto desempenho (IOPS alto)        | ✘             | ✔ (Premium SMB/NFS) | ✘              | ✘              | Premium (SSD)      | Arquivos corporativos, FSLogix, compartilhamentos de alta performance         |
| **Premium Storage (Page Blobs)**   | Focado em discos (VHDs) para VMs              | Discos de VM, banco de dados em disco premium     | Page Blobs    | ✘                   | ✘              | ✘              | Premium            | Usado para discos de VMs (OS/Data)                                            |


- **Descrição**:
É o contêiner base para todos os tipos de armazenamento do Azure (blobs, arquivos, tabelas e filas). Permite escolher redundância, desempenho e replicação.

- **SKU**:
    - Standard - HDD
    - Premium - SSD
    - Não é possível converter de um tipo para outro.
    - É necessário copiar os dados para outra Storage Account.

Quando uma conta de armazenamento utiliza StorageV2, é possível definir blobs individuais com camadas diferentes (cold, archive).
Na StorageV1, quem define a camada, é a própria storage account.

- Um storage account v2 LRS pode ser convertida para ZRS com live migration pelo Azure Support.
- Um fileshare premium só pode ser criado em um Storage do tipo FileStorage
- Uma storage account v1 não suporta ZRS, e não tem suporte para Replicação de objeto.
    Para criar opções de redundancia, a melhor opção é migrar para uma storage account v2.
- Storage Standard suporta:
    - Blob Storage (Hot, Cool, Archive)
    - File Storage 
    - Queue e Table
- Storage Premim suporta:
    - Blob Storage (BlockBlobStorage)
    - File Storage (Premium)
    - Disk Storage
- Storage Premium permite FileShare com SMb Multichannel.

- **Casos de uso**:
Armazenar dados de aplicações, backups, logs e arquivos estáticos.

- **Caracteristicas principais**:
Tipos de redundância (LRS, ZRS, GRS), controle de acesso e integração com Azure AD.

- **Escalabilidade**:
Até petabytes.

- **Disponibilidade**:
99,999999999% de durabilidade (com GRS).

- **Segurança**:
    - Criptografia AES-256, Private Endpoints, SAS Tokens.
    - Chaves de acesso de conta de armazenamento
    - SAS (assinatura de acesso compartilhado).\
      concede direitos de acesso restritos e por tempo limitado.
    - RBAC: O Storage suporta RBAC com condições para Containers e Filas.
    - Access Policy: 
        - É possivel configurar politicas de acesso, ou retenção para que um blob não seja excluido ou modificado em um periodo de tempo.
        - Permite definir permissões fixas para SAS Tokens, garantindo que todas assinaturas geradas sigam as restrições impostas. (somente leitura)
    - Access Policy são apenas para Containers dentro de uma Storage Account.
    - Para dar permissão para um Usuário do Azure AD enviar arquivos para uma Storage Account:
        - Reader (para conseguir ver os Storage Account)
        - Storage Blob Data Contributor (para conseguir enviar/download de arquivos)


- **SAS**:
    - Parametros necessários para gerar um token SAS: SignedResourceTypes e  SignedServices 

- **Criptografia**:
    O Azure Storage Encryption (SSE – Storage Service Encryption) protege dados em repouso (at rest) automaticamente.
    Toda vez que você grava um dado (Blob, File, Queue, Table), ele é criptografado antes de ser persistido nos discos físicos da Microsoft.
    Quando o dado é lido, ele é descriptografado automaticamente, de forma transparente.

    É utilizado criptografia bidirecional, com chaves simétricas

    - Criptografia do Storage Account
        - MMK - Microsoft Managed Keys
        - CMK - Customer Managed Keys

- **Nome exclusivo no Azure Inteiro**
    ```
    mystorageaccount.blob.core.windows.net
    mystorageaccount.table.core.windows.net
    mystorageaccount.file.core.windows.net
    mystorageaccount.queue.core.windows.net
    ```
- **Tipos de acesso**:
    - Public
    - Privado 
    - private endpoints
    - Somente através de VNET ou IP especifico.

- **Autenticação**:
    - Access Keys
        - connection string
        - 2 chaves
        - acesso full
    - SAS
        - Acesso a nivel de item (blob, container)
        - Temporário
    - IAM (RBAC)

- **Replicação**:
    - Modos de replicação entre regiões são assincrono. (GRS,RA-GRS,RA-GZRS)
    - Modos de replicação entre datacenters são sincronos. (LRS, ZRS)
    - SKU Standard permite replicação entre Regiões.
    - SKU Premiuum só permite replicação entre Zonas.
    - Replicação de Objetos podem ser feitos apenas em StorageV2.

*Assincrono*: Grava em um local primeiro para depois gravar nos demais.
*Sincrono*: Grava em todos os locais juntos.

- **Outros**:
    - Politicas de LifeCycle para Blobs podem ser aplicados para:
        - Criação / Modificação 
        - Snapshots
        - Versões

    - Imutabilidade pode ser aplicado a Conta de Armazenamento ou em uum Container Individual

### Envio de arquivos/ tabelas:
- Portal
- AzCli
- Azure Storage Explorer
- AzCopy
    - Métodos de autenticação
        - Blob: Azure AD e SAS
        - File Share: SAS 
    - O AzCopy pode ser utilizado para enviar arquivos para File e Blobs
- Azure Data Box Disk (appliance)

Copiar:
```
azcopy copy "https://<storageaccount>.blob.core.windows.net/<container>?<SAS_TOKEN>" "/local/path" --recursive
```

Sincronizar Diretório:
```
azcopy sync "/local/path" "https://<storageaccount>.blob.core.windows.net/<container>?<SAS_TOKEN>" --recursive
```

Criar um Container:
```
azcopy make "https://mystorageaccount.blob.core.windows.net/vmimages"
```

### Blob Storage

- **Descrição**:
Serviço para armazenar objetos não estruturados como imagens, vídeos, logs e backups.

- **Casos de uso**:
Hospedagem de conteúdo estático e dados de aplicações.

- **Caracteristicas principais**:
Hot/Cool/Archive tiers, versionamento, blob lifecycle.

- Politicas de LifeCycle podem ser aplicadas para:
    - StorageV2
    - BlobStorage
    - BlockBlobStorage
- Porém, para Archive Tier somente:
    - StorageV2
    - BlobStorage
- Politicas de LifeCycle podem ter Filtros (Prefix), com nome de pasta/file.

- **Escalabilidade**:
Virtualmente ilimitada.

- **Disponibilidade**:
Alta, com redundância geográfica.

- **Segurança**:
SAS, chaves de acesso e criptografia.

- **Tipos de acesso**:
    - Privado: (padrão) proibir o acesso anônimo ao contêiner e blobs.
    - Blob: permitir acesso de leitura público anônimo somente para blobs.
    - Contêiner: permitir acesso público anônimo de leitura e lista para o contêiner inteiro, incluindo os blobs.

- **Tipos de Blob**:
    - Block Blobs - arquivos geral - padrão
    - Append Blobs - logs
    - Page Blobs - discos (leitura/gravação)
    - *Não é possível alterar um tipo de Blob*

- **Caamdas**:
    - Hot
    - Esporádico - min 30 dias
    - Cold - min 90 dias
    - Archive - min 180 dias

- **Replicação**:
    - Necessita controle de versão para ambas as contas de armazenamento habilitados.
    - Habilitar o feed de alterações para conta de origem

### File Storage (Azure Files)

- **Descrição**:
Oferece compartilhamento de arquivos SMB ou NFS como em um servidor local, mas hospedado no Azure.

- **Casos de uso**:
Montar unidades de rede entre VMs ou sistemas locais.

- **Caracteristicas principais**:
SMB 3.0, snapshots, integração com AD DS.

- **Escalabilidade**:
Até 100 TB por share.

- **Disponibilidade**:
ZRS e GRS.

- **Segurança**:
Criptografia em trânsito e repouso.

- **Recuperação**:
    - Snapshots
    - Soft Delete (1 a 365 dias)
        Este parametro apaga o arquivo, mas fica o tempo configurado ainda, para poder restaurar se necessário.
    Sync para manter arquivos mais usados localmente (cache)

- Permite Autenticação baseada em identidade com AD Local. 
    - Necessita habilitar Autenticação com AD DS .
    - Necessita registrar a conta de armazenamento no AD local.

- Azure Files acesso baseado em Identidade - Somente SMB. Não NFS.

### Azure File Sync (Marketplace)
    - Criar um Sync Group (Cloud Endpoint)
        - Relacionar uma Storage Account
        - Relacionar um FileShare
    - Criar um Server Endpoint
        - Necessário instalar o Azure File Sync Agent no Servidor
        - Configurar o Azure File Sync Agent (Subscription, Rg, Sync Group)
        - Registrar pelo Portal o Server Endpoint
        - Escolher uma pasta

### Azure Data Box
- appliance para Transferir dados local para Nuvem
    - Import / Export Job (transferencia de dados local para Nuvem ou inverso)
        - Usa arquivo driveset.csv
        - WAImportExport Tool preparo para Import / Export - arquivo .jm (journalfile)
    - Import Support : File and Blob (block blob e Page blob)
    - Export Support: Blob (Block Blob, Page blob, Append Blob)
- Sequência correta:
    - Criar Import Job no Portal
    - Usar o WAImportExport Tool para copiar dados para o disco
    - Atualizar o Import Job no Portal com o Journal File
    - Enviar os discos e Acompanhar

### Azure Backup

- **Descrição**:
Solução de backup gerenciada que protege VMs, bancos de dados e arquivos contra perda de dados.

- **Casos de uso**:
Backup automático de VMs e restauração rápida em falhas.

- **Caracteristicas principais**:
Incremental, agendamento flexível, cofre seguro.

- **Escalabilidade**:
Depende do volume de dados.

- **Disponibilidade**:
Redundância geográfica.

- **Segurança**:
Criptografia ponta a ponta, isolamento por cofre.

- **Requisitos**:
    - Recovery Services Vault
        - Politica de Backup  
        - Restore
        - Site Recovery

Hoje já é possível centralizar tudo no Azure Backup Center e também realizar backups de outros tipos de Recursos.

    - Recovery Services Vault
        - Azure Virtual Machines
        - SQL in Azure VM
        - Azure Files
        - SAP HANA
    - Backup Vault
        - Azure Disks
        - Azure Blobs
        - Azure Database for PostgreSQL
        - Kubernetes Services

- **Redundancia**:
    - Locally redundant
    - Zone-redundant
    - Geo-redundant

- **MARS**: Microsoft Azure Recovery Services, ou seja, para fazer Backup de arquivos.

- **Politica Padrão de Retenção**: 30 dias

- **Exclusão**:

    Para excluir um Recovery Vault
    - Settings
    - Propriedades
    - Security Settings
        - Desativar - Soft delete for cloud workloads
        - Desativar - Soft delete for hybrid workloads

- Os jobs de Backup não agrupam tipos de backup diferentes. Isto vale para As politicas de Backup também.
    - Backup VM
    - FileShare
 - A retenção para Backup Vault é inferior a de Recovery Services Vault. Padrão 7 dias.
 - Uma VM desligada pode fazer parte e ter o seu Backup normalmente.
 - Necessita de uma role para Backup Vault conseguir fazer backup de discos gerenciados.
 - Restore de um Backup de VM:
    - Nova 
    - Replace
- Restore de Files:
    - Qualquer VM na subscription
    - Restore Disks
    - File Recovery para Computador Local
- Restore de um disco gerenciado, somente para um novo disco
- Para excluir um Recovery Service Vault, não precisa apagar os Backups, basta Parar cada Item de Backup.

### RTO e RPO

O RTO (objetivo de tempo de recuperação) é o tempo estipulado para que um processo empresarial seja restaurado após um desastre, a fim de evitar consequências inaceitáveis. Por exemplo, se um aplicativo crítico cair devido a uma falha no servidor e a empresa só puder tolerar um máximo de quatro horas de tempo de inatividade, o RTO será de quatro horas.

O RPO (objetivo de ponto de recuperação) é a quantidade máxima de perda de dados, medida no tempo, que a sua organização pode sustentar durante um evento.

O cenário de exemplo a seguir descreve os conceitos de RPO e RTO:

Sua organização tem um RPO de uma hora para o banco de dados de clientes, o que significa que você faz backups a cada hora. Em caso de um incidente de perda de dados, você não perderá mais de uma hora de dados. Quando você define o RTO como três horas, se ocorrer uma falha no sistema, sei objetivo é restaurar o acesso ao banco de dados em até três horas, a fim de minimizar o impacto nas operações.

### Azure Site Recovery (ASR)

- **Descrição**:
Serviço de recuperação de desastres que replica VMs e workloads entre regiões.

- **Casos de uso**:
Garantir continuidade de negócios e failover automático.

- **Caracteristicas principais**:
Replicação contínua, failback, testes de DR.

- **Escalabilidade**:
Por número de VMs.

- **Disponibilidade**:
Alta.

- **Segurança**:
Dados criptografados durante replicação.

- É boa prática ter VNET, Subnet configurados na outra região. Se puder ser uma VNET separada (sem peering), melhor. Defina mesmos nomes de Subnets.
- Crie uma Subnet de teste Failover.
- Necessita ter um Storage Account para Cache na origem.

- Para efetuar um Teste de Failover em um Azure Disaster Recovery, é necessário selecionar a VNET e subnet, mas há algumas condições:
    - Se existir um mesmo nome de Subnet, irá utilizar este.
    - Se não existir um mesmo nome, mas existir outras subnets, irá selecionar a primeira da lista (alfabetica) 
    - Se não existir nenhuma, irá sugerir um nome semelhante com prefix/sufix DR.

## 4. Computação
### Virtual Machines (VMs)

- **Descrição**:
    - Instâncias de servidores virtuais configuráveis em hardware, sistema operacional e rede.
    - É possivel criar outras VMs a partir de uma, exportando o modelo e usando o Azure Resource Manager (ARM).

- **Casos de uso**:
Hospedagem de aplicações, AD, bancos de dados e APIs.

- **Caracteristicas principais**:
VMs Windows/Linux, snapshots, Managed Disks.

- **Escalabilidade**:
Vertical e horizontal.

- **Disponibilidade**:
SLA 99,9%.

- **Segurança**:
Defender, NSG, Managed Identity.

- **DNS Virtual Machines**:
    ```
    - nome-da-vm.internal.cloudapp.net 
    ```

### Availability Set

- **Descrição**:
Agrupa VMs para garantir que não fiquem no mesmo host físico, evitando falhas simultâneas.

- **Casos de uso**:
Aumentar disponibilidade de serviços críticos.

- **Caracteristicas principais**:
Domínios de falha e atualização.

- **Escalabilidade**:
Até 200 VMs.

- **Disponibilidade**:
Alta, dentro de uma região.

- **Segurança**:
Evita downtime simultâneo.

- Se precisar alterar o SKU (resize) de uma VM que pertence a um Availability SET, é necessário parar todas as VMs que fazem parte do conjunto. Caso contrário, receberá uma mensagem de erro.

- Fault Domains - Máximo 3 - Parametro ARM Template: platformFaultDomainCount
- Update Domains - Máximo 20 - Parametro ARM Template: platformUpdateDomainCount

### VM Scale Set (VMSS)

- **Descrição**:
Grupo de VMs idênticas com balanceamento de carga e autoscaling automático.

- **Casos de uso**:
Aplicações web escaláveis e APIs.

- **Caracteristicas principais**:
Autoscaling, Load Balancer integrado.

- **Escalabilidade**:
Horizontal automática.

- **Disponibilidade**:
Multi-AZ.

- **Segurança**:
Integração com NSG e Defender.

### Azure Bastion

- **Descrição**:
Acesso seguro via RDP/SSH sem necessidade de IP público.

- **Casos de uso**:
Acesso remoto seguro a VMs em redes privadas.

- **Caracteristicas principais**:
TLS direto via navegador.

- **Escalabilidade**:
Automática.

- **Disponibilidade**:
Alta.

- **Segurança**:
Nenhum IP público exposto.

- AzureBastionSubnet (nome da subnet padrão) 
- Subnet com /27 (32 IPs) mínimo

- Permite gravar sessões. 
    - Necessita de um storage para guardar as gravações

- **SKU**:
    - Basic - Até 25 sessões simultâneas - Não escalável
    - Standard - Até 50 instâncias, ou seja, 1250 sessões simultâneas.

## 5. Aplicações e Containers
### App Service

- **Descrição**:
Plataforma PaaS para hospedar aplicações web (ASP.NET, Node.js, Python, Java, etc.) sem gerenciar servidores. Oferece integração com pipelines CI/CD, autoscaling e domínios customizados.

- **Casos de uso**:
Sites corporativos, APIs REST e portais internos.

- **Caracteristicas principais**:
Web Apps, Deployment Slots, integração com GitHub e Azure DevOps.

- **Escalabilidade**:
Horizontal e vertical automática (planos de serviço ajustáveis).

- **Disponibilidade**:
Multi-instance e multi-região.

- **Segurança**:
TLS/SSL, integração com Azure AD, e backup automático.

- **DNS único**:
    ```
    webappxpto.azurewebsites.net
    ```
- **Slot de Implantação**:
Permite criar ambientes de testes, homologação sem afetar o ambiente produtivo. Além disso é possível ativar um destes ambientes como principal. 

- **Implantação continua (ci/cd)**:
Permite implantação automatizada diretamente do repositório, ao executar um push.

### AppService Plan

Para execução de um AppService, é obrigatório a criação de um AppService Plan. Basicamente é a infraestrutura de servidor responsável pela execução do AppService.

| Planos  | Computacao | Instancias | Domain | Auto Scaling | Private Endpoint | Apps | Slots | 
| --- | --- | --- | --- | --- | --- | --- | --- | 
| Free F1 | Compartilhado | 1 | Nao | Nao | Nao | 10 | Nao | 
| Shared D1 | Compartilhado |  1 | Sim | Nao | Nao | 100 | Nao | 
| Basic B1 | Dedicado | 3  | Sim | Nao | Nao | Ilimitado | Nao | 
| Standard S1 | Dedicado | 10 | Sim | Sim | Nao | Ilimitado | 5 | 
| Premium V2 P1 | Dedicado | 30 | Sim | Sim | Sim | Ilimitado | 20 | 
| Isolado I1 | Dedicado + Vnet | 100 | Sim | Sim | Sim | Ilimitado | 20 | 

- **Scale UP**: Mudar o plano, aumentar, de Free para Basic, ou para Standard. B1 para B3, etc. Basicamente é um aumento Vertical.
- **Scale Out**: Aumentar o número de instâncias. Basicamente é um aumento Horizontal.

### Azure Functions

- **Descrição**:
Serviço de computação serverless que executa código sob demanda, sem necessidade de provisionar VMs. Você paga apenas pelo tempo de execução.

- **Casos de uso**:
Processamento de eventos, automações, ETL, Webhooks e APIs leves.

- **Caracteristicas principais**:
Várias linguagens (C#, Python, JavaScript), bindings com outros serviços, integração com Event Grid e Service Bus.

- **Escalabilidade**:
Totalmente automática (escalabilidade elástica).

- **Disponibilidade**:
Alta (gerenciada pelo Azure).

- **Segurança**:
Integrada com Managed Identity, VNet e Application Insights.

### Azure Container Apps (ACA)

- **Descrição**:
É uma plataforma serverless gerenciada para executar containers sem precisar gerenciar o plano de controle/Kubernetes. ACA fornece um ambiente para rodar aplicações conteinerizadas com recursos de aplicação (revisões, tráfego dividido, Dapr, etc.) e integrações prontas para auto-scale, observabilidade e networking

- **Casos de uso**:
    - Microservices leves que precisam de deploy rápido sem operar cluster Kubernetes.
    - APIs HTTP que devem escalar até zero quando não houver tráfego.
    - Workloads event-driven (filas/pub-sub) usando KEDA para escalar por eventos.
    - Ambientes que precisam de deploys com revisions e split de tráfego (blue/green, A/B).

- **Caracteristicas principais**:
    - Serveless containers
    - Autoscaling por Keda
    - Revisão e Traffic Splitting
    - Integrações com ACR, Application Insights, Log Analytics

- **Escalabilidade**:
    - Horizontal
    - Projetado para escalar rapidamente sem gerenciar nodes

- **Disponibilidade**:
    - Regional
    - Zona
    - Global: você pode implantar ambientes em múltiplas regiões e combinar com Traffic Manager / Front Door para roteamento global (se precisar)

- **Segurança**:
    - Suporte a private endpoints, Private access
    - Secrets nativos no Key Vault
    - Managed Identities

- **SKU**:
    - **Consumption (serverless)**
        - **Descrição**: modelo serverless — apps escalam automaticamente (até zero) e você paga por recurso usado (vCPU-seconds, GiB-seconds) e por requisições HTTP (primeiros créditos mensais grátis).
        - **Quando usar**: cargas com picos imprevisíveis, testes, aplicações de baixo tráfego ou que podem escalar até zero

    - **Dedicated**
        - **Descrição**: modelo com perfis de carga de trabalho que alocam instâncias (nós VMs) dedicadas à sua environment — ideal para necessidades de performance previsível ou hardware especializado (ex.: memória grande ou GPU). Você paga por instância do workload profile (por node) e não apenas por replica por segundo.
        - **Quando usar**: cargas estáveis/constantes, necessidades de alto throughput, aplicações que exigem mais CPU/RAM ou GPUs, cenários que exigem isolamento de compute

### Azure Container Instances (ACI)

- **Descrição**:
Execução rápida de containers sem necessidade de orquestrador. Ideal para workloads simples e temporários.

- **Casos de uso**:
Jobs de processamento isolado, scripts automáticos e tarefas sob demanda.

- **Caracteristicas principais**:
Deploy instantâneo, integração com VNet e suporte a imagens privadas.

- **Escalabilidade**:
Horizontal (vários containers).

- **Disponibilidade**:
Alta.

- **Segurança**:
Isolamento por container, integração com Azure AD e Private Link.

### Azure Kubernetes Service (AKS)

- **Descrição**:
Serviço gerenciado de orquestração de containers baseado em Kubernetes. Cuida do controle plane, atualizações e escalabilidade automática.

- **Casos de uso**:
Aplicações microservices, APIs escaláveis, workloads distribuídos.

- **Caracteristicas principais**:
Node pools, autoscaler, upgrade automático, integração com ACR e monitoramento nativo.

- **Escalabilidade**:
Altamente escalável (nós e pods).

- **Disponibilidade**:
Multi-zone e auto-healing.

- **Segurança**:
RBAC, integração com Azure AD, Network Policies e Defender for Containers.

### Azure App Configuration

- **Descrição**:
Centraliza parâmetros e configurações de aplicações em um único serviço.

- **Casos de uso**:
Gestão de chaves, feature flags e variáveis de ambiente em múltiplos ambientes.

- **Caracteristicas principais**:
Controle de versão, rollback, integração com Key Vault.

- **Escalabilidade**:
Global.

- **Disponibilidade**:
Alta.

- **Segurança**:
Controle de acesso granular e criptografia automática.

### Comparativo:

- *ACA - Aplicativos de Container Azure*
- *ACI - Instâncias de Container Azure*

| Tipo | ACA | ACI | App Service |
| --- | --- | --- | --- |
| Visao Geral | Plataforma serverless para microsserviços e APIs, baseada em Kubernetes, KEDA, Dapr e Envoy. | Execução rápida de containers isolados sem necessidade de orquestração ou gerenciamento de infraestrutura. | PaaS para hospedagem de aplicações web (.NET, Java, Node.js, Python etc.) com gerenciamento automático. |
| Implantação | Via CLI, ARM, Bicep, GitHub Actions; suporta revisões e divisão de tráfego. | Simples via az container create, Docker CLI, ARM templates. | CI/CD com GitHub Actions, Azure DevOps, FTP, WebDeploy, Kudu. Suporte a slots de implantação. | 
| Gerenciamento |Totalmente gerenciado; abstrai Kubernetes. | Sem gerenciamento de infraestrutura; limitado em monitoramento e rede. | Gerenciado; oferece diagnósticos, logs, backups, e integração com Application Insights. | 
| Escalabilidade | Autoscaling com KEDA (HTTP, eventos, filas); escala para zero. | Escalabilidade manual; sem autoscaling nativo. | Autoscaling baseado em métricas (CPU, memória, requisições). | 
| Caso de uso |  Microsserviços, APIs, jobs assíncronos, apps com carga variável | Jobs curtos, pipelines de dados, protótipos, tarefas event-driven. | Web apps tradicionais, REST APIs, backends móveis. | 
| Integração | Dapr (service-to-service), KEDA, Envoy, GitHub Actions, Azure Monitor. | Azure Logic Apps, Functions, Docker CLI, Azure Files. | Azure SQL, Redis, Key Vault, GitHub, Azure DevOps, Application Gateway. 
| Resumo | Ideal para arquiteturas modernas e dinâmicas, com foco em microsserviços e escalabilidade automática. | Melhor para execuções rápidas e isoladas, sem necessidade de orquestração. | Recomendado para aplicações web tradicionais com necessidade de alta disponibilidade e integração CI/CD. | 

## 6. Monitoramento e Observabilidade
### Azure Monitor

- **Descrição**:
- Plataforma central de coleta e análise de métricas e logs de todo o ambiente Azure.
- Na maioria dos casos, necessita de um Log Analytics Workspace.
- Ao habilitar o Monitoring / Logs ou Insights em um Recurso, será instalado o Client do Azure Monitor
    - Necessita de um Data Collection Rule
        - Guest Performance
        - Map (dependencies)
        - Log Analytics Workspace
    - Padrão: Somente dados de performance
    - Melhor forma para monitorar vários recursos (instalar agente), é usar uma Azure Policy.

- **Casos de uso**:
Monitorar performance de VMs, alertas de disponibilidade e consumo de recursos.

- **Caracteristicas principais**:
Métricas, logs, dashboards, alertas, e integração com Application Insights.

- **Escalabilidade**:
Suporte a grandes volumes de dados de telemetria.

- **Disponibilidade**:
Alta.

- **Segurança**:
Dados criptografados e integração com RBAC.

### Data Collection Rules

- Data sources padrão - Performance Counters
    - CPU
    - Memoria
    - Disco
    - Network
    - System
    - Process

- Opções extras:
    - Windows Event Logs
    - Linux syslog
    - IIS Logs
    - Firewall Logs
    - Custom Text Logs
    - Custom Json Logs
    - Prometheus Metrics

- É possível selecionar as VMS a partir deste Data Collection Rules. É uma alternativa viável.

### Log Analytics

- **Descrição**:
- Serviço que armazena e analisa logs do Azure Monitor usando consultas Kusto Query Language (KQL). O Log Analytics é mais utilizado para logs avançados.
- A cobrança é feita por dados armazenados. Custo alto.

- **Casos de uso**:
Diagnóstico de falhas, análise de desempenho e auditoria de segurança.

- **Caracteristicas principais**:
KQL, workspaces, queries interativas e integração com Sentinel.

- **Escalabilidade**:
Armazena terabytes de logs.

- **Disponibilidade**:
Alta.

- **Segurança**:
Criptografia e controle de acesso granular.

- **Tables**:"
Tabelas com dados dos recursos coletados para serem consultados, gerado gráficos.

O padrão vem poucas tabelas, mas a partir do momento que é configurado alguma Métrica ou Insights, será criado automaticamente novas tabelas.

Para visualizar estes dados, é utilizado a linguagem KQL.

### Application Insights

- **Descrição**:
Ferramenta APM (Application Performance Monitoring) que coleta telemetria de aplicações web e APIs.

- **Casos de uso**:
Monitorar tempo de resposta, falhas, dependências e comportamento do usuário.

- **Caracteristicas principais**:
Trace, métricas, mapa de aplicação e alertas inteligentes.

- **Escalabilidade**:
Global.

- **Disponibilidade**:
Alta.

- **Segurança**:
Dados criptografados e mascaramento de informações sensíveis.

### Alerts

É possível criar alertas para ações que acontecerem em uma conta do Azure ou também com ações de recursos.

- **Log de atividade**:
    - uma alteração de recurso
    - remoção de um lock

- **Log de recurso**:
    - cpu acima de 90%
    - disco cheio

- Como criar uma regra de Alerta:
    - Alert Rule
        - Condiction (cpu 90%)
        - Action (Enviar email)
    - Action group
        - Notificação
            - Email
            - SMS
        - Ação
            - Webhook
            - Azure Function
            - Automation Runbook
            - outros...
    - Alert processing rule

- Envio de SMS: Existe uma limitaçâo para envio de SMS de alertas. 1 a cada 5 minutos.
- É possível selecionar várias condições para uma regra de alerta.

- Cada regra é definida para uma métrica.
- Cada ação é definido para uma regra. Você pode enviar um email para várias pessoas em uma regra.
- Você pode usar o mesmo Action Group em várias regras.

Quando é criado uma regra de Alerta no Azure Montor, o target será o Azure Log Analytics Workspace, pois é ele que está recebendo os logs e métricas.


### Azure Service Health

- **Descrição**:
Fornece informações sobre incidentes e manutenção de serviços do Azure que afetam sua assinatura.

- **Casos de uso**:
Receber alertas sobre interrupções regionais ou problemas planejados.

- **Caracteristicas principais**:
Health Alerts, Planned Maintenance, Resource Health.

- **Escalabilidade**:
Global.

- **Disponibilidade**:
Alta.

- **Segurança**:
Informações seguras e isoladas por assinatura.

## 7. Automação e Gestão
### Azure Automation

- **Descrição**:
Serviço para criar runbooks (scripts PowerShell/Python) que automatizam tarefas administrativas, como desligar VMs ou aplicar patches.

- **Casos de uso**:
Manutenção periódica, compliance, automação de rotinas.

- **Caracteristicas principais**:
Runbooks, DSC (Desired State Configuration), Webhooks.

- **Escalabilidade**:
Execução paralela de múltiplos jobs.

- **Disponibilidade**:
Alta.

- **Segurança**:
Identidade gerenciada e logs auditáveis.

### Azure Logic Apps

- **Descrição**:
Ferramenta de automação visual baseada em fluxos, integrando serviços com conectores (Office 365, SAP, SQL, etc).

- **Casos de uso**:
Integração entre sistemas corporativos, notificações, ETL simples.

- **Caracteristicas principais**:
Conectores prontos, triggers e conditions.

- **Escalabilidade**:
Automática conforme execução.

- **Disponibilidade**:
Alta.

- **Segurança**:
Integração com Azure AD e criptografia de dados.

### Azure Resource Manager (ARM Template)

- **Descrição**:
Camada de gerenciamento que controla criação, atualização e exclusão de recursos Azure via templates JSON ou API.

- **Casos de uso**:
Deploy padronizado de ambientes completos.

- **Caracteristicas principais**:
Templates, tags, locks e consistência de estado.

- **Escalabilidade**:
Suporta múltiplas assinaturas e grupos de recursos.

- **Disponibilidade**:
Alta.

- **Segurança**:
RBAC e bloqueios de recurso (Locks).

Você pode utilizar o comando PowerShell `New-AzDeployment` para criar um novo recurso a partir de um Template.\
Para especificar o template em um container de armazenamento, utilize o parametro -TemplateUri .

Todo o gerenciamento de ARM Templates, passa por um Resource Group.
- Criação 
- Revisão
- Visualizar os Deployments aplicados


### Bicep

- **Descrição**:
Linguagem declarativa simplificada que compila em ARM Templates.

- **Casos de uso**:
Infraestrutura como código (IaC) moderna e mais legível que JSON.

- **Caracteristicas principais**:
Modularidade, IntelliSense e reutilização.

- **Escalabilidade**:
Criação massiva de recursos.

- **Disponibilidade**:
Nativa.

- **Segurança**:
Controlada por RBAC e pipelines.

## 8. Segurança e Conformidade

### Tags

São pares de chave/valor que você aplica em recursos, grupos de recursos ou assinaturas para organizar e classificar o ambiente.

- Como ajudam na governança:
    - Gestão de custos
    - Automação e politicas
    - Organização e rastreabilidade

- Tags podem ser aplicados a:
    - Subscription
    - Resource Groups
    - Recurso Individual

### Locks

Sáo bloqueios administrativos para impedir exclusões ou alterações acidentais.

- Como ajudam na governança:
    - Evita exclusão acidental
    - Garante integridade de infraestrutura
    - Complementa RBAC e Policy

- Locks podem ser aplicados a :
    - Subscription
    - Resource Groups
    - Recurso Individual

- Um lock de delete, não impede mover recursos entre Resource Group, Subscription ou Região.
- Praticamente todos recursos podem ser movidos entre Resource Groups, Subscriptions, etc, exceto: 
    - Express Route 
    - Recovery Service Vault
    - Bastion

- Lock de Read-Only não permite que mova um recurso, tanto na origem, quanto no destino.
- Lock de Delete permite que mova um Recurso.

### Azure Key Vault

- **Descrição**:
Cofre seguro para armazenar segredos, chaves e certificados usados por aplicações e serviços.

- **Casos de uso**:
Proteger credenciais, tokens e certificados SSL.

- **Caracteristicas principais**:
Secrets, Keys, Certificates, e integração com AD.

- **Escalabilidade**:
Global.

- **Disponibilidade**:
Alta, com failover geográfico.

- **Segurança**:
HSMs, RBAC, logs de auditoria e rotação automática.

### Microsoft Defender for Cloud

- **Descrição**:
Plataforma unificada de proteção que fornece visibilidade, recomendações de segurança e detecção de ameaças.

- **Casos de uso**:
Avaliar postura de segurança, habilitar proteção contra ataques e aplicar benchmarks (CIS, ISO).

- **Caracteristicas principais**:
Secure Score, recomendações, alertas e integração com Sentinel.

- **Escalabilidade**:
Abrange todo o ambiente cloud.

- **Disponibilidade**:
Alta.

- **Segurança**:
Proteção ativa e análise comportamental.

### Azure Security Center (agora parte do Defender for Cloud)

- **Descrição**:
Consolida políticas de segurança e fornece monitoramento centralizado de ameaças.

- **Casos de uso**:
Cumprimento de compliance e resposta rápida a incidentes.

- **Caracteristicas principais**:
Postura de segurança, recomendações, automação de resposta.

- **Escalabilidade**:
Global.

- **Disponibilidade**:
Alta.

- **Segurança**:
Controle de vulnerabilidades e integração com SIEM.

### Azure Sentinel (Microsoft Sentinel)

- **Descrição**:
SIEM (Security Information and Event Management) baseado em nuvem, que coleta e correlaciona logs de diversas fontes.

- **Casos de uso**:
Detecção de ameaças, hunting e resposta a incidentes.

- **Caracteristicas principais**:
Regras de correlação, dashboards, automação com Logic Apps.

- **Escalabilidade**:
Global e ilimitada.

- **Disponibilidade**:
Alta.

- **Segurança**:
Dados criptografados e controle por roles.

### Network Watcher

- **Descrição**:
Ferramenta de diagnóstico e monitoramento de rede no Azure.

- **Casos de uso**:
Verificar conectividade, analisar tráfego e capturar pacotes.

- **Caracteristicas principais**:
Connection Monitor, NSG Flow Logs, Packet Capture.

- **Escalabilidade**:
Por região.

- **Disponibilidade**:
Alta.

- **Segurança**:
Apenas metadados de rede, sem expor payloads.

- **Ferramentas**:    
    - Log Analytics Workspace
    - Application Insights (APM)
    - Network Watcher (IaaS)
        - Connection Monitor
            - Precisa instalar o Agent Network Watcher
        - Topology
        - Traffic Analytics
        - Ip flow verify
            - Também informa qual NSG está bloqueando um trafego.
        - NSG Diagnostics
        - Next Hop
        - Effective security rules
        - VPN Troubleshoot
        - Packet capture
        - Connection troubleshoot


## 9. Custos e Suporte
### Azure Cost Management

- **Descrição**:
Ferramenta de análise e controle de custos, integrada ao portal do Azure.

- **Casos de uso**:
Monitorar gastos, criar orçamentos e prever consumo.

- **Caracteristicas principais**:
Budget, forecast, cost analysis.

- **Escalabilidade**:
Multi-assinatura.

- **Disponibilidade**:
Alta.

- **Segurança**:
Controle via RBAC e dados protegidos.

### Azure Advisor

- **Descrição**:
Assistente inteligente que fornece recomendações sobre custo, desempenho, segurança e confiabilidade.

- **Casos de uso**:
Otimização de recursos ociosos e ajuste de performance.

- **Caracteristicas principais**:
Recomendações automáticas, pontuação e relatórios.

- **Escalabilidade**:
Global.

- **Disponibilidade**:
Alta.

- **Segurança**:
Nenhum impacto operacional — apenas leitura.

### Azure Support Plans

- **Descrição**:
Planos de suporte (Basic, Developer, Standard, Professional Direct) com diferentes níveis de SLA e prioridade.

- **Casos de uso**:
Suporte técnico e arquitetural em ambientes produtivos.

- **Caracteristicas principais**:
SLA, suporte 24x7, resposta prioritária.

- **Escalabilidade**:
Por assinatura.

- **Disponibilidade**:
Global.

- **Segurança**:
Acesso restrito a equipe autorizada.

## Dominios:

<https://learn.microsoft.com/en-us/azure/security/fundamentals/azure-domains>

| Serviço Azure | Domínio Público (FQDN) | 
| --- | --- |
| Virtual Machines (IaaS) | *.cloudapp.net ou *.cloudapp.azure.comApp  | 
| Service (Web Apps) | *.azurewebsites.net | 
| Blob Storage | *.blob.core.windows.net | 
| File Storage | *.file.core.windows.net | 
| Queue Storage | *.queue.core.windows.net | 
| Table Storage | *.table.core.windows.net | 
| Azure SQL Database | *.database.windows.net | 
| Azure Container Registry | *.azurecr.io | 
| Azure Key Vault | *.vault.azure.net | 
| Azure Kubernetes Service | *.azmk8s.io | 
| Azure CDN | *.vo.msecnd.net | 
| Azure Traffic Manager | *.trafficmanager.net | 
| Azure Front Door | *.azurefd.net | 

## Checklist de Labs Práticos – AZ-104
### Identidade e Governança

- Criar usuário e grupo no Azure AD.
- Atribuir uma role RBAC para um usuário em um Resource Group.
- Criar uma Azure Policy que bloqueia a criação de VMs de tamanho específico.
- Aplicar tags em recursos e forçar via Policy.

### Redes

- Criar uma VNet com 2 subnets.
- Configurar NSG para permitir RDP/SSH somente do seu IP.
- Fazer peering entre 2 VNets.
- Criar um Load Balancer e balancear tráfego entre 2 VMs.
- Configurar um Application Gateway com WAF.

### Armazenamento

- Criar um Storage Account com redundância GRS.
- Criar um Blob Container e enviar arquivos via portal e via CLI.
- Criar um File Share e montar em uma VM Windows e Linux.
- Gerar um SAS Token para acesso temporário ao Blob.

### Máquinas Virtuais

- Criar uma VM Windows e conectar via RDP.
- Criar uma VM Linux e conectar via SSH.
- Configurar Availability Set com 2 VMs.
- Criar um VM Scale Set com autoscale por CPU.
- Acessar uma VM via Azure Bastion.

### Aplicações e Containers

- Criar um App Service e publicar uma aplicação web simples.
- Habilitar deployment slot no App Service.
- Criar um Container Instance a partir de uma imagem no Docker Hub.
- Subir um cluster básico no AKS e rodar um pod Nginx.

### Monitoramento e Backup

- Habilitar Azure Monitor em uma VM.
- Criar uma alerta de CPU > 80% para uma VM.
- Criar uma consulta KQL no Log Analytics (ex: VMs que foram reiniciadas).
- Configurar backup de uma VM.
- Configurar Site Recovery entre duas regiões.

## Lab

https://aka.ms/esilabs

EBA439A97E274DF8


## Anotações
